"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.formatPath = formatPath;
exports.route = void 0;

var _slugg = _interopRequireDefault(require("slugg"));

var _get = _interopRequireDefault(require("lodash/get"));

var _toPath = _interopRequireDefault(require("lodash/toPath"));

var _curry = _interopRequireDefault(require("lodash/curry"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const nameGroup = '([a-zA-Z][a-zA-Z0-9.]*)';
const variableRegex = new RegExp(':' + nameGroup + '|{' + nameGroup + '}', 'g');

// eslint-disable-line @typescript-eslint/no-explicit-any
function formatPath(pathStr, data) {
  const result = {
    warnings: [],
    path: ''
  };
  result.path = pathStr.replace(variableRegex, (_, colon, curly) => {
    const type = typeof data;
    const propPath = colon || curly;

    if (type === 'object') {
      const value = String((0, _get.default)(data, propPath) || '');

      if (value === '') {
        result.warnings.push(propPath);
      }

      return (0, _slugg.default)(value);
    }

    if (propPath === 'num' || propPath === 'value') {
      return (0, _slugg.default)(String(data));
    }

    result.warnings.push(propPath);
    return '';
  });
  return result;
}

const route = (0, _curry.default)((config, routeName, data) => {
  const path = (0, _get.default)(config, ['routes'].concat((0, _toPath.default)(routeName), 'path'));
  return formatPath(path, data).path;
});
exports.route = route;